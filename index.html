<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Qubit Bloch Sphere Simulation</title>
    <!-- Include PyScript CSS and JavaScript -->
    <link rel="stylesheet" href="https://pyscript.net/latest/pyscript.css" />
    <script defer src="https://pyscript.net/latest/pyscript.js"></script>
    <!-- Include necessary JavaScript libraries for 3D rendering -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjs/10.6.4/math.min.js"></script>
</head>
<body>
    <h1>Qubit Bloch Sphere Simulation with State Vector Display</h1>
    <p>Use the buttons below to view different states on the Bloch sphere.</p>
    <!-- Container for the 3D scene -->
    <div id="scene-container" style="width: 100%; height: 600px;"></div>
    <!-- Buttons for state selection -->
    <div>
        <button onclick="setState('|0>')">|0></button>
        <button onclick="setState('|1>')">|1></button>
        <button onclick="setState('|+>')">|+></button>
        <button onclick="setState('|->')">|-></button>
        <button onclick="setState('|i>')">|i></button>
        <button onclick="setState('|-i>')">|-i></button>
        <button onclick="setState('Superposition')">Superposition</button>
    </div>
    <!-- Display for state vector and amplitudes -->
    <div id="state-display">
        <p id="state-vector">State Vector: |ψ⟩ = </p>
        <p id="amplitudes">Amplitudes: </p>
    </div>
    <!-- PyScript block for Python code -->
    <py-script>
        import math
        from js import document, THREE

        # Function to create the 3D scene
        def create_scene():
            # Scene setup
            scene = THREE.Scene.new()
            scene.background = THREE.Color.new(0.5, 0.5, 1)  # Light orange background

            # Camera setup
            camera = THREE.PerspectiveCamera.new(75, window.innerWidth / window.innerHeight, 0.1, 1000)
            camera.position.z = 5

            # Renderer setup
            renderer = THREE.WebGLRenderer.new()
            renderer.setSize(window.innerWidth, window.innerHeight)
            document.getElementById('scene-container').appendChild(renderer.domElement)

            # Bloch sphere
            geometry = THREE.SphereGeometry.new(1, 32, 32)
            material = THREE.MeshBasicMaterial.new({'color': 0xffffff, 'opacity': 0.3, 'transparent': True})
            bloch_sphere = THREE.Mesh.new(geometry, material)
            scene.add(bloch_sphere)

            # Axes
            axes_helper = THREE.AxesHelper.new(1.5)
            scene.add(axes_helper)

            # Render loop
            def animate():
                window.requestAnimationFrame(animate)
                renderer.render(scene, camera)

            animate()

        # Function to update the state display
        def update_state_display(state_name, amplitude_0, amplitude_1):
            state_vector = f"State Vector: |ψ⟩ = {amplitude_0:.2f}|0⟩ + ({amplitude_1:.2f})|1⟩"
            document.getElementById('state-vector').innerText = state_vector
            amplitudes = f"Amplitudes:\n  |0⟩: {amplitude_0:.4f}\n  |1⟩: {amplitude_1:.4f}"
            document.getElementById('amplitudes').innerText = amplitudes

        # Functions to set predefined states
        def set_state(state):
            if state == '|0>':
                update_state_display('|0>', 1.0, 0.0)
            elif state == '|1>':
                update_state_display('|1>', 0.0, 1.0)
            elif state == '|+>':
                update_state_display('|+>', 0.7071, 0.7071)
            elif state == '|->':
                update_state_display('|->', 0.7071, -0.7071)
            elif state == '|i>':
                update_state_display('|i>', 0.0, 1.0j)
            elif state == '|-i>':
                update_state_display('|-i>', 0.0, -1.0j)
            elif state == 'Superposition':
                update_state_display('Superposition', 0.7071, 0.7071)

        # Initialize the scene
        create_scene()
    </py-script>
    <!-- JavaScript functions to handle button clicks -->
    <script>
        function setState(state) {
            // Call the Python function to update the state
            pyscript.interpreter.globals.get('set_state')(state);
        }
    </script>
</body>
</html>
